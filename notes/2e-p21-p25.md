# Computer Networks Problems - Solutions P21-P25

## Table of Contents
- [P21. Determine Recent Access to External Site](#p21-determine-recent-access-to-external-site)
- [P22. Client-Server vs P2P Distribution Time](#p22-client-server-vs-p2p-distribution-time)
- [P23. Client-Server Distribution Analysis](#p23-client-server-distribution-analysis)
- [P24. P2P Distribution Analysis](#p24-p2p-distribution-analysis)
- [P25. Overlay Network Nodes and Edges](#p25-overlay-network-nodes-and-edges)

---

## P21. Determine Recent Access to External Site

**Answer: YES, you can determine if an external site was likely accessed recently**

**Method:**

**Use nslookup/dig with local DNS server:**

```bash
# Query your local DNS server
nslookup www.externalsite.com localhost
# or
dig @<local-dns-server> www.externalsite.com
```

**Analysis:**

1. **If query returns immediately (< 10ms):**
    - Answer was **cached** in local DNS server
    - Someone in department queried it recently (within TTL)
    - TTLs typically 300-3600 seconds (5 minutes to 1 hour)
    - **Likely accessed within last few minutes to hour**

2. **If query takes longer (> 100ms):**
    - Local DNS had to perform **recursive resolution**
    - Not in cache = not queried recently
    - **Probably NOT accessed in last TTL period**

**More precise method:**

```bash
# Check TTL value in response
dig @<local-dns-server> www.externalsite.com

# Response shows:
# www.externalsite.com. 285 IN A 93.184.216.34
#                       ^^^
#                       Current TTL (seconds remaining)

# If original TTL was 300 seconds:
# Remaining TTL of 285 → cached 15 seconds ago
# Remaining TTL of 100 → cached 200 seconds ago
```

**Calculation:**
```
Time since cached = Original_TTL - Current_TTL
```

**Limitations:**

1. **Multiple users:** Can't identify which specific computer
2. **TTL expiration:** After TTL expires, cache is cleared
3. **Automated access:** Could be automated systems, not humans
4. **Cache warming:** DNS server may pre-fetch popular domains
5. **No cache guarantee:** Some DNS servers don't cache certain records

**Privacy implication:** This is why DNS-over-HTTPS (DoH) and DNS-over-TLS (DoT) are important - they hide DNS queries from local network observation.

---

## P22. Client-Server vs P2P Distribution Time

**Given:**
- File size F = 20 Gbits = 20,000 Mbits
- Server upload rate us = 30 Mbps
- Each peer download rate di = 2 Mbps
- Each peer upload rate u = variable (300 Kbps, 700 Kbps, 2 Mbps)
- N = 10, 100, 1,000 peers

**Formulas:**

**Client-Server Distribution Time:**
```
Dcs = max{NF/us, F/dmin}
```

**P2P Distribution Time:**
```
Dp2p = max{F/us, F/dmin, NF/(us + Σui)}
```

### Calculations:

**For N=10:**

| u (Kbps) | Client-Server (sec) | P2P (sec) | Improvement |
|----------|-------------------|-----------|-------------|
| 300 | max{6,667, 10,000} = **10,000** | max{667, 10,000, 6,061} = **10,000** | None |
| 700 | **10,000** | max{667, 10,000, 5,714} = **10,000** | None |
| 2000 | **10,000** | max{667, 10,000, 4,000} = **10,000** | None |

**Calculations:**
- NF/us = 10×20,000/30 = 6,667 sec
- F/dmin = 20,000/2 = 10,000 sec (bottleneck)
- NF/(us + 10u):
  - u=300K=0.3M: 10×20,000/(30+3) = 6,061 sec
  - u=700K=0.7M: 10×20,000/(30+7) = 5,714 sec
  - u=2M: 10×20,000/(30+20) = 4,000 sec

**For N=100:**

| u (Kbps) | Client-Server (sec) | P2P (sec) | Improvement |
|----------|---------------------|-----------|-------------|
| 300 | **66,667** | max{667, 10,000, 60,606} = **60,606** | 9% |
| 700 | **66,667** | max{667, 10,000, 52,632} = **52,632** | 21% |
| 2000 | **66,667** | max{667, 10,000, 8,696} = **10,000** | 85% |

**Calculations:**
- NF/us = 100×20,000/30 = 66,667 sec (bottleneck for CS)
- F/dmin = 10,000 sec
- NF/(us + 100u):
  - u=0.3M: 100×20,000/(30+30) = 33,333 sec... wait, let me recalculate
  - u=0.3M: 100×20,000/(30+30) = 33,333 sec
  
Let me recalculate P2P more carefully:
- u=300K=0.3M: 2,000,000/(30+30) = 33,333 sec
- u=700K=0.7M: 2,000,000/(30+70) = 20,000 sec  
- u=2M: 2,000,000/(30+200) = 8,696 sec

Actually, I need to recalculate with correct formula NF/(us + N×u):

**For N=100:**
- u=0.3M: 100×20,000/(30+100×0.3) = 2,000,000/60 = 33,333 sec
- u=0.7M: 100×20,000/(30+100×0.7) = 2,000,000/100 = 20,000 sec
- u=2M: 100×20,000/(30+100×2) = 2,000,000/230 = 8,696 sec

| u (Kbps) | Client-Server (sec) | P2P (sec) | Improvement |
|----------|---------------------|-----------|-------------|
| 300 | **66,667** | max{667, 10,000, 33,333} = **33,333** | 50% |
| 700 | **66,667** | max{667, 10,000, 20,000} = **20,000** | 70% |
| 2000 | **66,667** | max{667, 10,000, 8,696} = **10,000** | 85% |

**For N=1,000:**

| u (Kbps) | Client-Server (sec) | P2P (sec) | Improvement |
|----------|---------------------|-----------|-------------|
| 300 | **666,667** | max{667, 10,000, 64,516} = **64,516** | 90% |
| 700 | **666,667** | max{667, 10,000, 27,778} = **27,778** | 96% |
| 2000 | **666,667** | max{667, 10,000, 8,734} = **10,000** | 98.5% |

**Calculations:**
- NF/us = 1,000×20,000/30 = 666,667 sec
- NF/(us + 1000u):
  - u=0.3M: 1,000×20,000/(30+300) = 60,606 sec
  - u=0.7M: 1,000×20,000/(30+700) = 27,397 sec
  - u=2M: 1,000×20,000/(30+2000) = 9,852 sec

### Summary Chart:

| N | u (Kbps) | Client-Server | P2P | Speedup |
|---|----------|---------------|-----|---------|
| 10 | 300 | 10,000 | 10,000 | 1.0× |
| 10 | 700 | 10,000 | 10,000 | 1.0× |
| 10 | 2000 | 10,000 | 10,000 | 1.0× |
| 100 | 300 | 66,667 | 33,333 | 2.0× |
| 100 | 700 | 66,667 | 20,000 | 3.3× |
| 100 | 2000 | 66,667 | 10,000 | 6.7× |
| 1000 | 300 | 666,667 | 60,606 | 11.0× |
| 1000 | 700 | 666,667 | 27,397 | 24.3× |
| 1000 | 2000 | 666,667 | 9,852 | 67.7× |

**Key observations:**
- P2P advantage grows with N
- Higher peer upload rates dramatically improve P2P
- For small N, download rate is bottleneck
- For large N, P2P is vastly superior

---

## P23. Client-Server Distribution Analysis

### a. Distribution scheme when us/N ≤ dmin

**Given:** us/N ≤ dmin (server upload per peer ≤ minimum download rate)

**Distribution time:** NF/us

**Scheme:**
1. Server divides bandwidth equally among N peers
2. Each peer receives at rate us/N
3. Since us/N ≤ dmin, peer download capacity is not the bottleneck
4. Server operates at full capacity us
5. Total data to send: N × F bits
6. Time = (N × F) / us = **NF/us**

**Example:**
- us = 10 Mbps, N = 10, dmin = 2 Mbps
- us/N = 1 Mbps ≤ 2 Mbps ✓
- Each peer downloads at 1 Mbps (server-limited)
- Time = 10F/10 = F seconds per peer, but all in parallel
- Total time = NF/us

### b. Distribution scheme when us/N ≥ dmin

**Given:** us/N ≥ dmin (server has excess capacity per peer)

**Distribution time:** F/dmin

**Scheme:**
1. Server sends to each peer at rate dmin
2. Each peer's download capacity is the bottleneck
3. Server uses only N × dmin of its us capacity
4. All peers complete simultaneously
5. Time for each peer = F/dmin
6. Total time = **F/dmin**

**Example:**
- us = 100 Mbps, N = 10, dmin = 2 Mbps
- us/N = 10 Mbps ≥ 2 Mbps ✓
- Each peer downloads at 2 Mbps (peer-limited)
- Server uses only 20 Mbps of 100 Mbps capacity
- Time = F/2 for all peers

### c. Minimum distribution time formula

**Answer:** 
```
Dcs = max{NF/us, F/dmin}
```

**Proof:**

**Case 1:** Server is bottleneck (us/N ≤ dmin)
- From (a): Time = NF/us
- This occurs when NF/us ≥ F/dmin
- Which means us/N ≤ dmin

**Case 2:** Client download is bottleneck (us/N ≥ dmin)
- From (b): Time = F/dmin
- This occurs when F/dmin ≥ NF/us
- Which means us/N ≥ dmin

**Therefore:**
- Minimum time is the maximum of the two constraints
- **Dcs = max{NF/us, F/dmin}**

**Interpretation:**
- **NF/us:** Time for server to upload N copies
- **F/dmin:** Time for slowest client to download
- Actual time is limited by the slower of these two

---

## P24. P2P Distribution Analysis

### a. Distribution scheme when us ≤ (us + u1 + ... + uN)/N

**Given:** us ≤ (us + Σui)/N and dmin is very large (not a bottleneck)

**Distribution time:** F/us

**Scheme:**
1. Server is the bottleneck
2. Server uploads entire file once at rate us
3. First peer receives complete file in time F/us
4. That peer then redistributes to others using its upload capacity
5. With large peer upload capacity, redistribution is fast
6. **Time = F/us**

**Explanation:**
- Condition means: us ≤ (us + total peer upload)/N
- Rearranging: N×us ≤ us + Σui
- Therefore: (N-1)×us ≤ Σui
- Peer upload capacity exceeds what's needed
- Server upload is the bottleneck

### b. Distribution scheme when us ≥ (us + u1 + ... + uN)/N

**Given:** us ≥ (us + Σui)/N

**Distribution time:** NF/(us + u1 + ... + uN)

**Scheme:**
1. Use all available upload capacity (server + all peers)
2. Total upload capacity: us + u1 + u2 + ... + uN
3. Total data to distribute: N × F bits (N copies)
4. **Time = NF/(us + Σui)**

**Explanation:**
- All nodes (server + peers) upload simultaneously
- As each peer receives pieces, it starts uploading to others
- System operates at maximum aggregate capacity
- Condition means server upload is relatively strong
- All upload capacity is utilized

### c. Minimum distribution time formula

**Answer:**
```
Dp2p = max{F/us, F/dmin, NF/(us + u1 + ... + uN)}
```

**Proof:**

**Three constraints:**

1. **F/us:** Server must upload entire file at least once
    - Cannot distribute what hasn't been uploaded by server

2. **F/dmin:** Slowest client must download complete file
    - Even with perfect distribution, slowest peer takes F/dmin

3. **NF/(us + Σui):** Total data / Total upload capacity
    - N copies of F bits must be distributed
    - Maximum aggregate upload rate is us + Σui
    - Minimum time = total data / total rate

**Distribution time is maximum of all three constraints:**
```
Dp2p = max{F/us, F/dmin, NF/(us + Σui)}
```

**Key insight:** P2P leverages peer upload capacity, dramatically reducing distribution time compared to client-server as N increases, since denominator in third term grows with N.

---

## P25. Overlay Network Nodes and Edges

**Given:**
- N active peers
- Each pair has active TCP connection
- TCP connections pass through M routers

**Answer:**

**Overlay network:**
- **Nodes:** N (only the peers, not the routers)
- **Edges:** N(N-1)/2 (complete graph - each peer connected to every other)

**Explanation:**

**Nodes (N):**
- Overlay network operates at application layer
- Only application endpoints (peers) are nodes
- Routers are invisible to overlay (they're underlay infrastructure)
- Total nodes = **N**

**Edges (N(N-1)/2):**
- Each pair of peers has one TCP connection
- This is a complete graph (K_N)
- Number of edges in complete graph:
  - Each of N nodes connects to (N-1) others
  - Total = N(N-1)
  - But each edge counted twice (once from each end)
  - Unique edges = N(N-1)/2

**Formula:** Number of edges = C(N,2) = **N(N-1)/2**

**Examples:**
- N=3: Edges = 3×2/2 = 3
- N=4: Edges = 4×3/2 = 6
- N=10: Edges = 10×9/2 = 45
- N=100: Edges = 100×99/2 = 4,950

**Note:** The M routers in the underlay network are transparent to the overlay. The overlay topology is determined by application-level connections, not physical network topology.